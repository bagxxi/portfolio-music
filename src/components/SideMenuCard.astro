---
import type { Playlist } from "@/lib/data";

interface Props {
  playlist: Playlist;
}

const { playlist } = Astro.props;
const { id, cover, title, artists, color } = playlist;

const artistsString = artists.join(", ");
---

<a
  href={`/playlist/${id}`}
  class="playlist-item flex relative p-2 overflow-hidden items-center gap-5 rounded-md hover:bg-surface-light/50 transition-colors border border-transparent hover:border-accent-cyan/20"
>
  <picture class="h-12 w-12 relative shrink-0 bg-surface-light rounded-md overflow-hidden">
    <img
      src={cover}
      alt={`Cover of ${title} by ${artistsString}`}
      class="w-full h-full object-cover rounded-md sidebar-cover"
      data-fallback="/placeholder.svg"
    />
  </picture>

  <div class="flex flex-auto flex-col truncate">
    <h4 class="text-text-bright text-sm">
      {title}
    </h4>

    <span class="text-xs text-text-muted">
      {artistsString}
    </span>
  </div>
</a>

<script>
  // Image fallback handling for sidebar
  document.addEventListener('astro:page-load', () => {
    const images = document.querySelectorAll('.sidebar-cover') as NodeListOf<HTMLImageElement>;
    images.forEach(img => {
      img.addEventListener('error', function() {
        const fallback = this.getAttribute('data-fallback');
        if (fallback && this.src !== fallback) {
          this.src = fallback;
        }
      });
    });
  });
</script>
